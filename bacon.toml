# Bacon configuration for multiple apps
default_job = "check"

[jobs.lint]
command = ["nx", "run-many", "-t", "lint", "--parallel=16"]
need_stdout = true

[jobs.check]
command = ["cargo", "check", "--color", "always"]
need_stdout = false

[jobs.zerg-api]
command = ["cargo", "run", "-p", "zerg_api", "--color", "always"]
need_stdout = true
watch = ["apps/zerg/api", "libs"]
allow_warnings = true
background = false
on_change_strategy = "kill_then_restart"

[jobs.zerg-tasks]
command = ["cargo", "run", "-p", "zerg_tasks", "--color", "always"]
need_stdout = true
watch = ["apps/zerg/tasks", "libs"]
allow_warnings = true
background = false
on_change_strategy = "kill_then_restart"
env = { PORT = "7777" }

[jobs.zerg-email]
command = ["cargo", "run", "-p", "zerg_email", "--color", "always"]
need_stdout = true
watch = ["apps/zerg/email", "libs"]
allow_warnings = true
background = false
on_change_strategy = "kill_then_restart"
env = { HEALTH_PORT = "8082", SMTP_HOST = "localhost", SMTP_PORT = "1025", SMTP_USE_TLS = "false", REDIS_HOST = "redis://localhost:6379", EMAIL_FROM_ADDRESS = "noreply@zerg.local", EMAIL_FROM_NAME = "Zerg" }

[jobs.terran-api]
command = ["cargo", "run", "-p", "terran_api", "--color", "always"]
need_stdout = true
watch = ["apps/terran/api", "libs"]
allow_warnings = true
background = false
on_change_strategy = "kill_then_restart"

[jobs.zerg-cli]
command = ["cargo", "run", "-p", "zerg_cli", "--color", "always"]
need_stdout = true

[jobs.zerg-operator]
command = ["cargo", "run", "-p", "zerg_operator", "--color", "always"]
need_stdout = true

# Watch all workspace members
[jobs.check-all]
command = ["cargo", "check", "--workspace", "--color", "always"]
need_stdout = false

[jobs.test-all]
command = ["cargo", "test", "--workspace", "--color", "always"]
need_stdout = true

[jobs.test-all-fast]
command = ["cargo", "test", "--workspace", "--color", "always"]
need_stdout = true
