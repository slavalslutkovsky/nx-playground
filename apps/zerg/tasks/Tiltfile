docker_build(
  'yurikrupnik/zerg-tasks',
  build_args={
    'APP_NAME': 'zerg_tasks',
  },
  context='../../..',
  dockerfile='../../../manifests/dockers/rust.Dockerfile',
  only=[
    'Cargo.toml',
    'Cargo.lock',
    'apps/',
    'libs/',
    'manifests/dockers/rust.Dockerfile',
  ],
  ignore=[
    'target/',
    '**/*.md',
    '**/.git/',
    '**/k8s/',
    '**/Tiltfile',
    'apps/**/node_modules/',
  ],
  live_update=[
    sync('apps/zerg/tasks/src', '/app/apps/zerg/tasks/src'),
  ],
  target='rust',
)

k8s_yaml(kustomize('k8s/kustomize/overlays/dev'))

k8s_resource("zerg-tasks", port_forwards="50051:50051", labels=['backend'])
