---
import BaseLayout from '../layouts/BaseLayout.astro';
import ProductGrid from '../components/ProductGrid.astro';
import { fetchProducts } from '../lib/api-client';

let products = [];
let error = null;

try {
  products = await fetchProducts({ limit: 8, status: 'active' });
} catch (e) {
  error = e instanceof Error ? e.message : 'Failed to load products';
}
---

<BaseLayout title="Home">
  <section class="mb-12">
    <div class="bg-gradient-to-r from-primary-600 to-primary-800 rounded-2xl p-8 md:p-12 text-white">
      <h1 class="text-3xl md:text-5xl font-bold mb-4">
        Welcome to Storefront
      </h1>
      <p class="text-lg md:text-xl text-primary-100 mb-6 max-w-2xl">
        Discover our curated selection of high-quality products at unbeatable prices.
      </p>
      <a
        href="/products"
        class="inline-block bg-white text-primary-600 px-6 py-3 rounded-lg font-semibold hover:bg-primary-50 transition-colors"
      >
        Shop Now
      </a>
    </div>
  </section>

  <section>
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold text-gray-900">Featured Products</h2>
      <a href="/products" class="text-primary-600 hover:text-primary-700 font-medium">
        View All â†’
      </a>
    </div>

    {error ? (
      <div class="bg-red-50 text-red-600 p-4 rounded-lg">
        <p>Error loading products: {error}</p>
        <p class="text-sm mt-2">Make sure the Products API is running on port 3003.</p>
      </div>
    ) : (
      <ProductGrid products={products} />
    )}
  </section>
</BaseLayout>
