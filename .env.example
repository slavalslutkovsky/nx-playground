# Environment Variables Template
# Copy this file to .env and fill in your actual values
#
# Usage:
#   cp .env.example .env
#   # Edit .env with your actual values
#   direnv allow  # If using direnv

# Database Configuration
DATABASE_URL=postgres://username:password@localhost/database_name

# Database Connection Pool Settings (Production Optimized)
# These values prevent socket timeouts and improve performance under high load

# Maximum number of connections in the pool (default: 100)
# Increase for high-traffic applications
DB_MAX_CONNECTIONS=150

# Minimum number of connections to maintain (default: 5)
# Higher values reduce connection startup latency
DB_MIN_CONNECTIONS=20

# How long to wait when connecting to database in seconds (default: 8)
DB_CONNECT_TIMEOUT_SECS=8

# How long to wait to acquire a connection from pool in seconds (default: 8)
# Increase if you see "timeout acquiring connection" errors
DB_ACQUIRE_TIMEOUT_SECS=10

# How long idle connections stay in pool before being closed in seconds (default: 8)
# Production: 600 (10 minutes) prevents excessive connection churn
DB_IDLE_TIMEOUT_SECS=600

# Maximum lifetime of a connection before forced recreation in seconds (default: 8)
# Production: 1800 (30 minutes) prevents stale connections while reducing overhead
DB_MAX_LIFETIME_SECS=1800

# Enable SQL query logging (default: true)
# Set to false in production for better performance
DB_SQLX_LOGGING=false

# CORS Configuration (Required)
# Comma-separated list of allowed origins for API access
# Development example:
CORS_ALLOWED_ORIGIN=http://localhost:3000,http://127.0.0.1:3000
# Production example:
# CORS_ALLOWED_ORIGIN=https://example.com,https://app.example.com
# Mixed (local dev + staging):
# CORS_ALLOWED_ORIGIN=http://localhost:3000,https://staging.example.com

# ============================================================================
# gRPC Services Configuration
# ============================================================================

# Tasks Service Address (gRPC)
# Local development (default if not set):
TASKS_SERVICE_ADDR=http://[::1]:50051
# Kubernetes (Kind) cluster:
# TASKS_SERVICE_ADDR=http://zerg-tasks.zerg.svc.cluster.local:50051
# Tilt port-forward (when running outside cluster):
# TASKS_SERVICE_ADDR=http://localhost:50051

# ============================================================================
# Tasks Service Configuration (zerg-tasks)
# ============================================================================

# gRPC server bind address
# Local development:
GRPC_HOST=[::1]
# Kubernetes (must bind to all interfaces):
# GRPC_HOST=0.0.0.0

# gRPC server port
GRPC_PORT=50051

# ============================================================================
# Redis Configuration
# ============================================================================

# Redis connection URL
# Local development:
REDIS_HOST=redis://localhost:6379
# Kubernetes (Kind) cluster:
# REDIS_HOST=redis://redis.dbs.svc.cluster.local

# ============================================================================
# Authentication & Security
# ============================================================================

# JWT secret for session tokens (CHANGE IN PRODUCTION!)
JWT_SECRET=dev-secret-change-in-production

# OAuth: Auto-link accounts with verified emails (safer to disable in production)
OAUTH_AUTO_LINK_VERIFIED_EMAILS=true

# Frontend URL for OAuth redirects
FRONTEND_URL=http://localhost:3000
REDIRECT_BASE_URL=http://localhost:8080

# ============================================================================
# OAuth Providers
# ============================================================================

# WorkOS AuthKit (recommended - replaces Google/GitHub OAuth)
# Sign up at https://workos.com and create an AuthKit application
# Client ID starts with "client_"
WORKOS_CLIENT_ID=client_your-workos-client-id
# API Key starts with "sk_test_" (staging) or "sk_live_" (production)
WORKOS_API_KEY=sk_test_your-workos-api-key

# Legacy OAuth (can be removed after WorkOS migration)
# Google OAuth
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# GitHub OAuth
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret

# ============================================================================
# Feature Flags (Flagsmith)
# ============================================================================

# Flagsmith API URL
# Local/self-hosted:
FLAGSMITH_API_URL=http://localhost:8000/api/v1
# Kubernetes:
# FLAGSMITH_API_URL=http://flagsmith-api.flagsmith.svc.cluster.local:8000/api/v1

# Flagsmith environment key
FLAGSMITH_ENVIRONMENT_KEY=your-flagsmith-key

# ============================================================================
# Server Configuration
# ============================================================================

# Server port (zerg-api)
PORT=8080

# Rust log level
# Development:
RUST_LOG=info,zerg_api=debug,tower_http=debug,sea_orm=info
# Production:
# RUST_LOG=info

# Environment
RUST_ENV=development
APP_ENV=development

