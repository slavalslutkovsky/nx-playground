# Environment Variables Template
# Copy this file to .env and fill in your actual values
#
# Usage:
#   cp .env.example .env
#   # Edit .env with your actual values
#   direnv allow  # If using direnv

# ============================================================================
# Database Configuration (PostgreSQL) - REQUIRED
# ============================================================================

DATABASE_URL=postgres://username:password@localhost/database_name

# Connection Pool Settings (Production Optimized)
DB_MAX_CONNECTIONS=150
DB_MIN_CONNECTIONS=20
DB_CONNECT_TIMEOUT_SECS=8
DB_ACQUIRE_TIMEOUT_SECS=10
DB_IDLE_TIMEOUT_SECS=600
DB_MAX_LIFETIME_SECS=1800
DB_SQLX_LOGGING=false

# ============================================================================
# Redis Configuration
# ============================================================================

# Redis connection (REDIS_URL takes precedence over REDIS_HOST)
REDIS_URL=redis://localhost:6379
# REDIS_HOST=redis://localhost:6379

# Optional Redis settings
# REDIS_DATABASE=0
# REDIS_USERNAME=
# REDIS_PASSWORD=

# ============================================================================
# Server Configuration (zerg-api)
# ============================================================================

# Server bind address and port
HOST=0.0.0.0
PORT=8080

# Environment
APP_ENV=development
RUST_ENV=development

# Logging (see: https://docs.rs/tracing-subscriber/latest/tracing_subscriber/filter/struct.EnvFilter.html)
RUST_LOG=info,zerg_api=debug,tower_http=debug,sea_orm=info

# ============================================================================
# gRPC Configuration (zerg-tasks)
# ============================================================================

# gRPC server bind address
# Local: [::1], Kubernetes: 0.0.0.0
GRPC_HOST=[::1]
GRPC_PORT=50051

# Tasks service address (for API to connect to gRPC service)
# Local: http://[::1]:50051
# Kubernetes: http://zerg-tasks.zerg.svc.cluster.local:50051
TASKS_SERVICE_ADDR=http://[::1]:50051

# ============================================================================
# Worker Health Ports
# ============================================================================

# Each worker has its own health port (falls back to HEALTH_PORT, then default)
EMAIL_WORKER_HEALTH_PORT=8081
TASKS_WORKER_HEALTH_PORT=8082
# HEALTH_PORT=8080  # Fallback for all workers

# ============================================================================
# Authentication & Security - REQUIRED
# ============================================================================

# JWT secret for session tokens (minimum 32 characters, CHANGE IN PRODUCTION!)
JWT_SECRET=dev-secret-change-in-production-min-32-chars

# CORS allowed origins (comma-separated)
CORS_ALLOWED_ORIGIN=http://localhost:3000,http://127.0.0.1:3000

# Frontend URL for OAuth redirects
FRONTEND_URL=http://localhost:3000
REDIRECT_BASE_URL=http://localhost:8080

# OAuth: Auto-link accounts with verified emails (safer to disable in production)
OAUTH_AUTO_LINK_VERIFIED_EMAILS=true

# ============================================================================
# OAuth Providers - REQUIRED for OAuth login
# ============================================================================

# Google OAuth (https://console.cloud.google.com/apis/credentials)
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# GitHub OAuth (https://github.com/settings/developers)
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret

# ============================================================================
# Email - SendGrid (Production)
# ============================================================================

# Get API key from https://app.sendgrid.com/settings/api_keys
SENDGRID_API_KEY=SG.your-sendgrid-api-key
SENDGRID_FROM_EMAIL=noreply@yourdomain.com
SENDGRID_FROM_NAME=Zerg

# Webhook secret for delivery status (https://app.sendgrid.com/settings/mail_settings)
# SENDGRID_WEBHOOK_SECRET=your-webhook-secret

# ============================================================================
# Email - SMTP (Development with Mailpit)
# ============================================================================

# Mailpit Web UI: http://localhost:8025
SMTP_HOST=localhost
SMTP_PORT=1025
SMTP_FROM_EMAIL=noreply@localhost
SMTP_FROM_NAME=Zerg Dev
# SMTP_USERNAME=
# SMTP_PASSWORD=
# SMTP_USE_TLS=false

# ============================================================================
# Email Worker Configuration
# ============================================================================

# Redis stream settings
EMAIL_STREAM_NAME=email:jobs
EMAIL_CONSUMER_GROUP=email_workers
EMAIL_DLQ_STREAM_NAME=email:dlq

# Processing settings
EMAIL_MAX_RETRIES=3
# EMAIL_POLL_INTERVAL_MS=500

# Email expiry settings
EMAIL_VERIFICATION_EXPIRY_HOURS=24
PASSWORD_RESET_EXPIRY_HOURS=1

# ============================================================================
# Tasks Worker Configuration
# ============================================================================

# Stream settings (prefix: TASKS_)
# TASKS_STREAM_NAME=tasks:commands
# TASKS_CONSUMER_GROUP=task_workers
# TASKS_DLQ_STREAM_NAME=tasks:commands:dlq

# Processing settings
# TASKS_BATCH_SIZE=50
# TASKS_POLL_INTERVAL_MS=100
# TASKS_BLOCK_TIMEOUT_MS=1000
# TASKS_MAX_RETRIES=3
# TASKS_MAX_CONCURRENT_JOBS=20
# TASKS_ENABLE_DLQ=true

# Recovery settings
# TASKS_CLAIM_IDLE_TIME_SECS=30
# TASKS_MAX_STREAM_LENGTH=100000

# ============================================================================
# Company Branding (for email templates)
# ============================================================================

COMPANY_NAME=Zerg
# COMPANY_ADDRESS=
# LOGO_URL=

# ============================================================================
# Feature Flags (Flagsmith) - Optional
# ============================================================================

# Flagsmith API URL
# Local: http://localhost:8000/api/v1
# Kubernetes: http://flagsmith-api.flagsmith.svc.cluster.local:8000/api/v1
# FLAGSMITH_API_URL=http://localhost:8000/api/v1
# FLAGSMITH_ENVIRONMENT_KEY=your-flagsmith-key
