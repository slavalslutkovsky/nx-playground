#apiVersion: kubernetes.crossplane.io/v1alpha1
#kind: Object
#metadata:
#  name: dam-configmap
#  namespace: default
#spec:
#  forProvider:
#    manifest:
#      apiVersion: v1
#      kind: ConfigMap
#      metadata:
#        namespace: default
#      data:
#        aris: "adas"
#        dam: "true"
#        lol: "2"
#        lol3: "4"
#  providerConfigRef:
#    name: default
#---
#apiVersion: v1
#kind: ConfigMap
#metadata:
#  name: title
#data:
#  key: "value"

  #apiVersion: helm.crossplane.io/v1beta1
#kind: Release
#metadata:
#  name: argo-example-crossplane
#spec:
#  forProvider:
#    chart:
#      name: argo-cd
#      repository: https://argoproj.github.io/argo-helm
#      version: 9.3.4
#    namespace: argo
#    wait: true
#    values:
#      service:
#        type: ClusterIP
##      wordpressUsername: admin
##      wordpressPassword: password123
##      mariadb:
##        enabled: true
#  providerConfigRef:
#    name: default
#---
# =============================================================================
# ArgoCD Resources (via provider-kubernetes)
# =============================================================================
# ArgoCD AppProject - defines access policies and allowed resources
#apiVersion: kubernetes.crossplane.io/v1alpha2
#kind: Object
#metadata:
#  name: argocd-project-example
#spec:
#  forProvider:
#    manifest:
#      apiVersion: argoproj.io/v1alpha1
#      kind: AppProject
#      metadata:
#        name: crossplane-managed
#        namespace: argo
#      spec:
#        description: "Project managed by Crossplane"
#        sourceRepos:
#          - "https://github.com/yurikrupnik/*"
#          - "https://charts.bitnami.com/bitnami"
#        destinations:
#          - namespace: "*"
#            server: "https://kubernetes.default.svc"
#        clusterResourceWhitelist:
#          - group: "*"
#            kind: "*"
#  providerConfigRef:
#    name: default
---
# ArgoCD Application - deploys an app from Git
#apiVersion: kubernetes.crossplane.io/v1alpha2
#kind: Object
#metadata:
#  name: argocd-app-example
#spec:
#  forProvider:
#    manifest:
#      apiVersion: argoproj.io/v1alpha1
#      kind: Application
#      metadata:
#        name: example-app
#        namespace: argo
#      spec:
#        project: crossplane-managed
#        source:
#          repoURL: https://github.com/your-org/your-repo
#          targetRevision: HEAD
#          path: manifests/app
#        destination:
#          server: https://kubernetes.default.svc
#          namespace: default
#        syncPolicy:
#          automated:
#            prune: true
#            selfHeal: true
#          syncOptions:
#            - CreateNamespace=true
#  providerConfigRef:
#    name: default
#---
# ArgoCD Application - deploy from Helm chart
#apiVersion: kubernetes.crossplane.io/v1alpha2
#kind: Object
#metadata:
#  name: argocd-helm-app-example
#spec:
#  forProvider:
#    manifest:
#      apiVersion: argoproj.io/v1alpha1
#      kind: Application
#      metadata:
#        name: redis-from-argocd
#        namespace: argo
#      spec:
#        project: crossplane-managed
#        source:
#          repoURL: https://charts.bitnami.com/bitnami
#          chart: redis
#          targetRevision: 18.6.1
#          helm:
#            values: |
#              architecture: standalone
#              auth:
#                enabled: false
#        destination:
#          server: https://kubernetes.default.svc
#          namespace: redis
#        syncPolicy:
#          automated:
#            prune: true
#            selfHeal: true
#          syncOptions:
#            - CreateNamespace=true
#  providerConfigRef:
#    name: default
#---
# =============================================================================
# FluxCD Resources (via provider-kubernetes)
# =============================================================================
# Flux GitRepository - defines a Git source
#apiVersion: kubernetes.crossplane.io/v1alpha2
#kind: Object
#metadata:
#  name: flux-gitrepo-example
#spec:
#  forProvider:
#    manifest:
#      apiVersion: source.toolkit.fluxcd.io/v1
#      kind: GitRepository
#      metadata:
#        name: crossplane-managed-repo
#        namespace: flux-system
#      spec:
#        interval: 5m
#        url: https://github.com/yurikrupnik/first-rust-app
#        ref:
#          branch: main
#  providerConfigRef:
#    name: default
---
# Flux Kustomization - applies manifests from GitRepository
#apiVersion: kubernetes.crossplane.io/v1alpha2
#kind: Object
#metadata:
#  name: flux-kustomization-example
#spec:
#  forProvider:
#    manifest:
#      apiVersion: kustomize.toolkit.fluxcd.io/v1
#      kind: Kustomization
#      metadata:
#        name: crossplane-managed-kustomization
#        namespace: flux-system
#      spec:
#        interval: 10m
#        sourceRef:
#          kind: GitRepository
#          name: crossplane-managed-repo
#        path: ./manifests
#        prune: true
#        targetNamespace: default
#  providerConfigRef:
#    name: default
#---

#apiVersion: storage.gcp.m.upbound.io/v1beta1
#kind: Bucket
#metadata:
#  annotations:
#    meta.upbound.io/example-id: storage/v1beta1/bucketobject
#  labels:
#    testing.upbound.io/example-name: bucket-object
#  name: yurikrupnikov-upbound-io
##  namespace: upbound-system
#spec:
#  forProvider:
#    location: US
#    storageClass: MULTI_REGIONAL
---
#apiVersion: storage.gcp.m.upbound.io/v1beta1
#kind: Bucket
#metadata:
#  annotations:
#    meta.upbound.io/example-id: storage/v1beta1/objectaccesscontrol
#  labels:
#    testing.upbound.io/example-name: bucket
#  name: bucket-random
#  namespace: upbound-system
#spec:
#  forProvider:
#    cors:
#      - maxAgeSeconds: 3600
#        method:
#          - GET
#          - HEAD
#          - PUT
#          - POST
#          - DELETE
#        origin:
#          - http://image-store.com
#        responseHeader:
#          - "*"
#    forceDestroy: true
#    location: US
#---
#apiVersion: pkg.crossplane.io/v1
#kind: Provider
#metadata:
#  name: upbound-provider-family-gcp
#spec:
#  package: xpkg.upbound.io/upbound/provider-family-gcp:v2.4.0
#---
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: pg
  namespace: zerg
spec:
  instances: 1

  postgresql:
    parameters:
      max_connections: "200"
      shared_buffers: "256MB"
      effective_cache_size: "1GB"
      maintenance_work_mem: "64MB"
      checkpoint_completion_target: "0.9"
      wal_buffers: "7864kB"
      default_statistics_target: "100"
      random_page_cost: "1.1"
      effective_io_concurrency: "200"
      work_mem: "655kB"
      min_wal_size: "1GB"
      max_wal_size: "4GB"

  bootstrap:
    initdb:
      database: postgres
      owner: postgres
      postInitSQL:
        - CREATE DATABASE app_dev;
        - CREATE DATABASE app_staging;
        - CREATE DATABASE grafana;

  storage:
    size: 20Gi
    # storageClass: standard-rwo  # GCP

  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

  monitoring:
    enablePodMonitor: true
#---
#apiVersion: platform.gitops.io/v1alpha1
#kind: PlatformBootstrap
#metadata:
#  name: mgmt-platform
#  namespace: flux-system
#spec:
#  environment: dev
#  clusterName: mgmt
#  features:
#    prometheus: true        # Deploy full Prometheus stack locally
#    vault: true
#    externalSecrets: true
#    vaultSecretsOperator: true
#    kyverno: true
#    crossplaneProviders: true
#  cloudProvider:
#    gcp:
#      enabled: true
#      projectId: playground-447016
#      workloadIdentity: false  # Not available in Kind
#    aws:
#      enabled: false
---
#   Backup configuration - requires S3/GCS credentials
#   backup:
#     barmanObjectStore:
#       destinationPath: gs://your-bucket/backups/shared-postgres
#       googleCredentials:
#         applicationCredentials:
#           name: backup-gcs-credentials
#           key: gcs-credentials.json
#       wal:
#         compression: gzip
#         maxParallel: 8
#     retentionPolicy: "30d"

## ExternalSecret to pull Vault cloud credentials from GCP Secret Manager
#apiVersion: external-secrets.io/v1
#kind: ClusterExternalSecret
#metadata:
#  name: vault-cloud-credentialsa
#spec:
#  externalSecretName: manager-secrets
#  namespaceSelectors:
#    - matchLabels:
#        secrets.external-secrets.io/enabled: "true"
#  refreshTime: "1m"
#  externalSecretSpec:
#    secretStoreRef:
##      name: gcp-secret-managers
#      kind: ClusterSecretStore
#
#    refreshInterval: "1h"
#    target:
#      name: manager-secrets
#      creationPolicy: 'Owner'
##    data:
##      - remoteRef:
###      - secretKey: ai # name of the GCPSM secret key
###          version: "2"
##          key: manager-secrets
#    #          property: container-puller
#    #    dataFrom:
#    #      - key: provider-key
#    #        version: provider-key-version
#    #        property: provider-key-property
#    #  secretStoreRef:
##    name: gcp-secret-manager
##    kind: ClusterSecretStore
##  target:
##    name: vault-cloud-credentials
##    creationPolicy: Owner
##  data:
##    - secretKey: manager-secrets
##      remoteRef:
##        key: vault-gcp-credentials
#    dataFrom:
#      - extract:
#          key: manager-secrets
##          property: ai
##  data:
#    # GCP credentials (JSON stored as string in Secret Manager)
##    - secretKey: GCP_CREDENTIALS
##      remoteRef:
##        #        key: iac-manager-gcp
##        key: manager-secrets
##        property: vault-gcp-credentials
##        property: vault-gcp-credentials
#    #        property: flagsmith
#    #        dataFrom:
#    #          - extract:
#    #              key: manager-secrets
#    #              property: flagsmith
#    # AWS credentials (JSON with access_key_id and secret_access_key)
##    - secretKey: AWS_ACCESS_KEY_ID
##      remoteRef:
##        key: vault-aws-credentials
##        property: access_key_id
##    - secretKey: AWS_SECRET_ACCESS_KEY
##      remoteRef:
##        key: vault-aws-credentials
##        property: secret_key
##    - secretKey: AWS_REGION
##      remoteRef:
##        key: vault-aws-credentials
##        property: region
#apiVersion: external-secrets.io/v1
#kind: ExternalSecret
#metadata:
#  name: gcp-crossplane-credentials
#  namespace: crossplane-system
#spec:
#  refreshInterval: 1h
#  secretStoreRef:
#    name: gcp-secret-manager
#    kind: ClusterSecretStore
#  target:
#    name: gcp-provider-secret
#    creationPolicy: Owner
#  data:
#    # GCP credentials (JSON stored as string in Secret Manager)
#    - secretKey: GCP_CREDENTIALS
#      remoteRef:
#        key: manager-secrets
#        property: iac-manager-gcp
#---
#apiVersion: external-secrets.io/v1
#kind: ExternalSecret
#metadata:
#  name: aws-crossplane-credentials
#  namespace: crossplane-system
#spec:
#  refreshInterval: 1h
#  secretStoreRef:
#    name: gcp-secret-manager
#    kind: ClusterSecretStore
#  target:
#    name: aws-provider-secret
#    creationPolicy: Owner
#  data:
#    # GCP credentials (JSON stored as string in Secret Manager)
#    - secretKey: AWS_CREDENTIALS
#      remoteRef:
#        key: manager-secrets
#        property: iac-manager-aws
#---
#apiVersion: aws.upbound.io/v1beta1
#kind: ProviderConfig
#metadata:
#  name: default
#spec:
#  credentials:
#    source: Secret
#    secretRef:
#      namespace: crossplane-system
#      name: aws-provider-secret
#      key: AWS_CREDENTIALS
---
#apiVersion: pkg.crossplane.io/v1
#kind: Provider
#metadata:
#  name: upbound-provider-aws-s3
#spec:
#  package: xpkg.upbound.io/upbound/provider-aws-s3:v2.3.0
#---
#apiVersion: pkg.crossplane.io/v1
#kind: Provider
#metadata:
#  name: upbound-provider-gcp-storage
#spec:
#  package: xpkg.upbound.io/upbound/provider-gcp-storage:v2.4.0
#---
#apiVersion: gcp.upbound.io/v1beta1
#kind: ProviderConfig
#metadata:
#  name: default
#spec:
#  projectID: playground-447016
#  credentials:
#    source: Secret
#    secretRef:
#      namespace: crossplane-system
#      name: gcp-provider-secret
#      key: GCP_CREDENTIALS
#---
#
#apiVersion: storage.platform.io/v1alpha1
#kind: Bucket
#metadata:
#  name: my-bucket-yurikrupnikov
##  namespace: default
#spec:
#  provider: gcp
#  region: us-east1
#  name: playground-447016-my-app-data
#---
#apiVersion: storage.platform.io/v1alpha1
#kind: Bucket
#metadata:
#  name: my-bucket-yurikrupnikov1
##  namespace: default
#spec:
#  provider: gcp
#  region: us-east1
#  name: playground-447016-my-zerg-data
#---
#---
#apiVersion: storage.platform.io/v1alpha1
#kind: Bucket
#metadata:
#  name: my-bucket-yurikrupnikov2
##  namespace: default
#spec:
#  provider: aws
#  region: us-east-1
#  name: playground-447016-my-protos-data
#---
#apiVersion: storage.gcp.upbound.io/v1beta1
#kind: Bucket
#metadata:
#  annotations:
#    meta.upbound.io/example-id: storage/v1beta1/bucketobject
#  labels:
#    testing.upbound.io/example-name: bucket-object
#  name: bucket-object-randomsdasd
##  namespace: upbound-system
#spec:
#  forProvider:
#    location: US
#    storageClass: MULTI_REGIONAL
---
#apiVersion: s3.aws.upbound.io/v1beta1
#kind: Bucket
#metadata:
#  annotations:
#    crossplane.io/external-name: random2314412
#    meta.upbound.io/example-id: s3/v1beta1/bucketnotification
#  labels:
#    testing.upbound.io/example-name: bucket-notification
#  name: bucket-notification-aris-random-shit
##  namespace: upbound-system
#spec:
#  forProvider:
#    region: us-west-1
---
#apiVersion: helm.toolkit.fluxcd.io/v2beta1
#kind: HelmRelease
#metadata:
#  name: neo4j
#  namespace: data
#spec:
#  chart:
#    spec:
#      chart: neo4j
#      sourceRef:
#        kind: HelmRepository
#        name: neo4j
#      version: "5.x.x"
#  values:
#    neo4j:
#      name: "agents-graph"
#      password:
#        secretKeyRef:
#          name: neo4j-credentials
#          key: password
#      edition: "community"  # or "enterprise"
#
#    volumes:
#      data:
#        mode: "dynamic"
#        dynamic:
#          storageClassName: "fast-ssd"
#          requests:
#            storage: 100Gi
#
#    resources:
#      requests:
#        memory: "4Gi"
#        cpu: "2"
#      limits:
#        memory: "8Gi"
#        cpu: "4"
