# Scheduled Backup Configuration for CNPG
# Requires object storage (S3, GCS, Azure Blob)
#
# For local development without object storage, use pg_dump instead:
#   kubectl exec -it zerg-db-1 -n zerg -- pg_dump -U zerg zerg > backup.sql
#
#  mydatabase
apiVersion: postgresql.cnpg.io/v1
kind: ScheduledBackup
metadata:
  name: zerg-db-backup
  namespace: zerg
spec:
  # Reference to the cluster
  cluster:
    name: zerg-db

  # Backup schedule (cron format)
  # Daily at 2:00 AM UTC
  schedule: "0 2 * * *"

  # Backup method
  # - barmanObjectStore: Full backup to object storage
  # - volumeSnapshot: Use CSI volume snapshots
  backupOwnerReference: self

  # Immediate backup on creation
  immediate: false

  # Suspend backups (useful for maintenance)
  suspend: false

---
# On-demand backup (apply when needed)
# kubectl apply -f - <<EOF
# apiVersion: postgresql.cnpg.io/v1
# kind: Backup
# metadata:
#   name: zerg-db-backup-$(date +%Y%m%d%H%M%S)
#   namespace: zerg
# spec:
#   cluster:
#     name: zerg-db
# EOF
